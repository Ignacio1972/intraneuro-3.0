<!DOCTYPE html>
<html lang="es">
<head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INTRANEURO - Sistema de Gesti√≥n Cl√≠nica</title>

    <!-- PWA Meta Tags -->
    <meta name="description" content="Sistema de gesti√≥n hospitalaria para cl√≠nica psiqui√°trica">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="INTRANEURO">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/assets/icons/icon-192x192.png">

<!-- CSS Files (en el <head>) -->
<link rel="stylesheet" href="css/main.css?v=50">
<link rel="stylesheet" href="css/pacientes.css?v=50">
<link rel="stylesheet" href="css/service-selector.css?v=1">
<link rel="stylesheet" href="css/modal.css?v=50">
<link rel="stylesheet" href="css/pacientes-print.css?v=23">
<link rel="stylesheet" href="css/chat-notes.css?v=5">
<!-- Sistema de chat desactivado - ahora usando sistema simple de textboxes -->
<!-- <link rel="stylesheet" href="css/clinical-chat.css?v=1"> -->
<!-- Sistema de Tareas con Checkboxes (Audio removido) -->
<link rel="stylesheet" href="css/task-manager.css?v=4">
<!-- Sistema de Notas de Voz para Pacientes -->
<link rel="stylesheet" href="css/voice-notes.css?v=1">
<!-- ‚ú® NUEVO: Sistema OCR para ingreso de pacientes -->
<link rel="stylesheet" href="css/ocr.css?v=1">
<!-- Sistema de Dropdowns -->
<link rel="stylesheet" href="css/dropdown-system.css?v=1">

    <!-- Flatpickr - Calendario visual -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Login Modal (initially shown) -->
    <div id="loginModal" class="modal active">
        <div class="modal-content login-content">
            <div class="login-container">
                <img src="assets/img/logo.png" alt="INTRANEURO" class="login-logo">
                <h2>Sistema de Gesti√≥n Cl√≠nica</h2>
                <form id="loginForm">
                    <div class="form-group" style="display: none;">
                        <input type="text" id="username" value="sistema" placeholder="Usuario">
                    </div>
                    <div class="form-group">
                        <input type="password" id="password" placeholder="Clave de Acceso" required autofocus>
                    </div>
                    <button type="submit" class="btn btn-primary">Ingresar</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Application (hidden until login) -->
    <div id="mainApp" style="display: none;">
        <!-- Header -->
        <header class="main-header">
            <div class="header-content">
                <a href="index.html" class="logo-section" style="text-decoration: none; color: inherit;">
                    <img src="assets/img/logo.png" alt="INTRANEURO" class="header-logo">
                    <span class="clinic-name">INTRANEURO</span>
                </a>
                <div class="user-section">
                    <span id="currentUser">Acceso autorizado</span>
                    <button id="logoutBtn" class="btn-logout">Cerrar Sesi√≥n</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard -->
            <section class="dashboard">
                <!-- Fila principal: Nuevo Ingreso a la izquierda, Archivo e Imprimir a la derecha -->
                <div class="dashboard-row" style="justify-content: space-between;">
                    <button id="newAdmissionBtn" class="btn btn-primary btn-admission">
                        <span class="icon">+</span> NUEVO INGRESO
                    </button>

                    <div class="dashboard-group">
                        <button class="view-btn" onclick="window.location.href='archivos.html'">üìÅ Archivo</button>
                        <button onclick="printActivePatients()" class="btn-icon" title="Imprimir">
                            üñ®Ô∏è
                        </button>
                    </div>
                </div>

            </section>


            <!-- Patients Container -->
            <section id="patientsContainer" class="patients-grid">
                <!-- Patient cards will be dynamically inserted here -->
            </section>

            <!-- Archive Link -->
            <div class="archive-link">
            <a href="archivos.html">üìÅ Ver Archivo de Pacientes Egresados</a>
            </div>
        </main>
    </div>

    <!-- Patient Modal -->
    <div id="patientModal" class="modal">
        <div class="modal-content patient-modal-content">
            <span class="close">&times;</span>
            <!-- Admission Data -->
            <div class="modal-section admission-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 0.5rem;">
                    <h2 style="margin: 0;">DATOS DE INGRESO</h2>
                    <button id="dischargeBtn" class="btn-logout">
                        Egresar Paciente
                    </button>
                </div>
                <div id="admissionData"></div>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div id="shareModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <span class="close" onclick="closeModal('shareModal')">&times;</span>
            <h2>Compartir Ficha del Paciente</h2>
            <div id="shareModalContent"></div>
        </div>
    </div>

    <!-- New Admission Modal -->
<!-- New Admission Modal -->
<div id="admissionModal" class="modal admission-modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Nuevo Ingreso</h2>

        <!-- ‚ú® NUEVO: Toggle OCR -->
        <div class="ocr-toggle-section">
            <button type="button" id="ocrToggleBtn" class="btn btn-secondary ocr-camera-btn">
                <img src="assets/img/camera.svg" alt="C√°mara" class="camera-icon">
                <span class="camera-text">Capturar con foto</span>
            </button>
        </div>

        <!-- ‚ú® NUEVO: Secci√≥n OCR (inicialmente oculta) -->
        <div id="ocrUploadSection" style="display: none;">
            <!-- El contenido se inyectar√° din√°micamente por OCRUploader -->
        </div>

        <form id="admissionForm">
            <div class="form-section">
                <h3>üìù Datos Personales</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Nombre y Apellido</label>
                        <input type="text" id="patientName" required>
                    </div>
                </div>
               
                <div class="form-row">
                    <div class="form-group">
                        <label>RUT (Opcional)</label>
                        <input type="text" id="patientRut" placeholder="Opcional - Sin validaci√≥n">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>üìÖ Ingreso</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Fecha de Ingreso</label>
                        <div class="date-input-group">
                            <input type="date" id="admissionDate" required>
                            <button type="button" class="btn-today" onclick="setToday('admissionDate')">HOY</button>
                        </div>
                    </div>
                </div>
                <!-- Dropdown de diagn√≥stico eliminado del ingreso - 18/12/2025
                     El diagn√≥stico se asigna desde el modal del paciente despu√©s del ingreso
                     Ver: js/modules/pacientes/pacientes-edit-refactored.js
                -->
                   <!-- CAMPO ALERGIAS TEMPORALMENTE DESHABILITADO - 08/08/2025
<div class="form-group">
    <label>¬øPresenta alergias?</label>
    <div class="radio-group">
        <label><input type="radio" name="allergies" value="no" checked> No</label>
        <label><input type="radio" name="allergies" value="yes"> S√≠</label>
    </div>
    <textarea id="allergyDetails" style="display: none;" placeholder="Especifique alergias..."></textarea>
</div>
-->
                </div>

                <!-- Campos ocultos para compatibilidad -->
                <input type="hidden" id="patientAge" value="">
                <input type="hidden" id="patientPrevision" value="">
                <input type="hidden" id="patientBed" value="">
                <input type="hidden" id="diagnosisDetails" value="">
                <input type="hidden" id="admittedBy" value="Sistema">
                <input type="hidden" id="noRut" value="false">

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Registrar Ingreso</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('admissionModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- JavaScript Files -->
     <script src="assets/libs/xlsx.full.min.js"></script>
     <!-- Fuse.js desactivado - Usando dropdown simple -->
     <!-- <script src="assets/libs/fuse.min.js"></script> -->

     <!-- Flatpickr - Calendario visual -->
     <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
     <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
     <script>
         // Verificar que Flatpickr se carg√≥ correctamente
         if (typeof flatpickr !== 'undefined') {
             console.log('‚úÖ Flatpickr cargado correctamente');
             // Configurar espa√±ol por defecto
             if (window.flatpickr && window.flatpickr.l10ns && window.flatpickr.l10ns.es) {
                 flatpickr.localize(flatpickr.l10ns.es);
                 console.log('‚úÖ Flatpickr configurado en espa√±ol');
             }
         } else {
             console.error('‚ùå Error: Flatpickr no se carg√≥ correctamente');
         }
     </script>

<!-- Core y utilidades primero -->
<!-- Configuraci√≥n global de servicios - Debe cargarse primero -->
<script src="js/services-config.js?v=1"></script>
<script src="js/api.js?v=50"></script>
<script src="js/validaciones.js?v=25"></script>
<script src="js/data-catalogos.js?v=21"></script>
<!-- M√≥dulos de UI -->
<script src="js/pacientes-ui.js?v=100"></script>
<!-- Sistema Unificado de Dropdowns v2.0 - DEBE cargarse ANTES de ingreso.js -->
<script src="js/modules/dropdown-system.js?v=3"></script>
<!-- Script de debug para dropdowns -->
<script src="js/debug-dropdowns.js"></script>
<!-- ‚ú® NUEVO: M√≥dulos OCR para ingreso desde foto -->
<script src="js/modules/ocr/ocr-uploader.js?v=20251121"></script>
<script src="js/modules/ocr/ocr-integration.js?v=20251121"></script>
<script src="js/modules/ocr/ocr-init.js?v=20251121"></script>
<!-- M√≥dulos principales -->
<script src="js/auth.js?v=50"></script>
<script src="js/ingreso.js?v=25"></script>

<!-- ===== Sistema modular de componentes desactivado ===== -->
<!-- Los componentes base-component.js y discharge-component.js -->
<!-- solo se usan en egreso.html, no en el dashboard principal -->
<!-- El modal-orchestrator.js fue cancelado en el pivote de arquitectura -->

<!-- Main DEBE ir antes de pacientes-refactored para declarar variables globales -->
<script src="js/main.js?v=50"></script>
<!-- M√≥dulos refactorizados de pacientes - DESPU√âS de main.js -->
<script src="js/modules/pacientes/pacientes-api.js?v=34"></script>
<!-- Sistema de edici√≥n refactorizado - SISTEMA UNIFICADO -->
<script src="js/modules/pacientes/pacientes-edit-refactored.js?v=5.5"></script>
<!-- Sistema de edici√≥n de servicio hospitalario -->
<script src="js/modules/pacientes/pacientes-service-edit.js?v=2"></script>
<script src="js/modules/pacientes/pacientes-discharge.js?v=37"></script>
<script src="js/pacientes-refactored.js?v=100"></script>
<!-- Sistema SIMPLIFICADO de notas - Solo textareas -->
<script src="js/simple-notes.js?v=3"></script>
<!-- Sistema de Tareas con Checkboxes y Audio -->
<script src="js/modules/task-manager.js?v=3"></script>
<script src="js/modules/task-audio.js?v=2"></script>
<!-- Sistema de Notas de Voz para Pacientes (MANTENER - NO TOCAR) -->
<script src="js/modules/patient-voice-notes.js?v=1"></script>
<!-- Sistema de Chat Cl√≠nico tipo WhatsApp - DESACTIVADO (ahora usando sistema simple de textboxes) -->
<!-- <script src="js/modules/clinical-chat.js?v=1"></script> -->
<!-- Archivo principal de pacientes - comentado para evitar conflictos con pacientes-refactored.js -->
<!-- <script src="js/pacientes.js?v=40"></script> -->

<!-- M√≥dulo de Servicios -->
<script src="js/modules/services.js?v=4"></script>
<script src="js/services-integration.js"></script>

<!-- PWA Service Worker -->
<script src="js/sw-register.js"></script>

<!-- Fix para edici√≥n de previsi√≥n - DESACTIVADO: Ahora incluido en pacientes-edit-refactored.js -->
<!-- <script src="js/fix-prevision-edit.js?v=1"></script> -->

<!-- Agregar antes del cierre de </body> en index.html -->
<footer class="app-footer">
    <small>
        <strong>INTRANEURO</strong> v2.7.0 | 
        ¬© 2025 <span style="color: #828e9a; font-weight: 200;">Lobo-Media</span> | 
        Sistema de Gesti√≥n Cl√≠nica | 
        Licencia Propietaria
    </small>
</footer>
</body>

</html>